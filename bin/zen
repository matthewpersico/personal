#!/usr/bin/env bash

declare o_width=1000
declare o_height=500
declare no_exec=0

# Define the options. ':' suffix for a mandatory value to an option, '::' for
# an optional one. Note that the long and short don't have to match up.
declare OPTSARGS
declare shortopts='w:h:n'
declare longopts='width:,height:,number;'

# Parse args.
OPTSARGS=$(getopt -a -o "$shortopts" -l "$longopts" -n "$(basename "$0")" -- "$@")
declare status=$?
((status != 0)) && exit $status

# Reset the command line ($@).
eval set -- "$OPTSARGS"

# Reprocess the command line, extracting options and their arguments into
# variables.
while true
do
    declare option=$1
    shift
    [ "$option" != '--' ] && option=${option##-} && option=${option##-}
    case "$option" in
        w | width )
            o_width=$1
            shift
            ;;
        h | height )
            o_height=$1
            shift
            ;;
        n | noexec )
            no_exec=1
            ;;
        --) break ;; ## VITAL!!! Exits the while loop, no more options,
                     ## remaining $*, if any, are args
        *)
            cmd-echo -ec -- "$option is an invalid option."
            cat "$0"
            exit 1
            ;;
    esac
done

if ((no_exec))
then
    echo "$* | zenity --text-info --auto-scroll --title=$* --width=$o_width --height=$o_height"
else
    "$@" | zenity --text-info --auto-scroll --title="$*" --width="$o_width" --height="$o_height"  &
fi
