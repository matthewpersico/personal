# -*- sh -*-
# shellcheck shell=bash

# Read the list
declare list=$1
if [[ -z $list ]]; then
    list="${TILDAE:-$HOME}/perl/remote/src/modules"
    cmd-echo --wc --id perl-install-modules-remote "No list argument specified. Using default of '$list'."
else
    shift;
fi
if [[ ! -r $list ]]; then
    cmd-echo --ec --id perl-install-modules-remote "Module list $list not readable."
    false; exit
fi

declare prefix=$1
if [[ -z $prefix ]]; then
    prefix="${TILDAE:-$HOME}/perl/local"
    cmd-echo --wc --id perl-install-modules-remote "No prefix argument specified. Using default of '$prefix'."
    if [[ ! -d $prefix ]]; then
        mkdir -p "$prefix"
    fi
else
    shift;
fi
if [[ ! -d $prefix ]]; then
    cmd-echo --ec -id perl-install-modules-remote "Directory $prefix not found."
    false; exit
fi

declare module
while read -r module; do
    perl-remote-install-module \
        --prefix "$prefix" \
        "$module"
done < <(cat "$list")
