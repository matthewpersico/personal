#!/usr/bin/env bash

# xterm-Xlocation

# shellcheck disable=SC1090 #https://github.com/koalaman/shellcheck/wiki/SC1090
source "$BASH_INC_DIR/on_exit.binc"
source "$BASH_INC_DIR/mktemp.binc"
declare Xid_file
Xid_file=$(mktempfile)
rm-on-exit "$Xid_file"
declare tmpname
tmpname=$(uuid)
settitle "$tmpname" && xwininfo -name "$tmpname" \
        | grep 'Window id' \
        | sed -e 's/.* Window id: //' -e 's/ .*//' > "$Xid_file"
declare Xid
Xid=$(cat "$Xid_file")
declare -a output
readarray -t output < <(xwininfo -id "$Xid")

declare x=-1
declare y=-1

for line in "${output[@]}"
do
    if [[ $line =~ Absolute\ upper-left\ X ]]
    then
        x="${line#*: }"
    elif [[ $line =~ Absolute\ upper-left\ Y ]]
    then
        y="${line#*: }"
    fi
    [[ $x != '-1' ]] && [[ $y != '-1' ]] && break
done
echo $x $y
