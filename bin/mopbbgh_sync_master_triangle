# -*- sh -*-

# mopbbgh_sync_triangle

# Keeps the canonical/fork/local set in sync, using canonical as
# authoritative

echo "Triangle syncing branch..."

typeset gcb=$(git_current_branch)
if [ "$gcb" != 'master' ]
then
    cmd="git stash"
    echo "Save any in progress work ($cmd)..."
    $cmd || exit 1

    cmd='git checkout master'
    echo "Switching to master branch ($cmd)..."
    $cmd || exit 1
fi

cmd='git pull upstream master'
echo "Syncing canonical to local ($cmd)..."
$cmd || exit 1

cmd='git push origin master'
echo "Syncing local to fork ($cmd)..."
$cmd || exit 1

if [ "$gcb" != 'master' ]
then
    cmd="git stash pop"
    echo "Restore any in progress work ($cmd)..."
    $cmd || exit 1

    cmd="git checkout $gcb"
    echo "Switching back to $gcb branch ($cmd)..."
    $cmd || exit 1
fi
