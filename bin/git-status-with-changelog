#!/usr/bin/env bash

# git-status-with-changelog

declare diff
declare cached
declare noclonly
declare moreopts=1
while [[ "$1" =~ ^- ]] && ((moreopts))
do
    declare original="$1"
    declare option
    option=$(dashstripper "$original")
    shift

    case $option in
        noclonly) noclonly='--noclonly';;
        diff) diff='--diff';;
        cached) cached='--cached';;
        h|help) script-usage; exit 0 ;;
        debug | x ) set -x; trap 'set +x' EXIT;;
        --) moreopts=0;;
        * )
            cmd-echo -- "$original is an invalid option. See $0 --help";
            exit 1
            ;;
    esac
done

## Locate all the files to process
declare -a filenames
if (($#))
then
    ## Process what's specified
    filenames=("$@")
else
    mapfile -t filenames < <(git what is edited)
fi

git-process-changelog --withstatus $diff $cached $noclonly "${filenames[@]}"

exit 0

:<< __USAGE__
NAME
    git-status-with-changelog

SYNOPSIS
    git-status-with-changelog TBD

DESCRIPTION
    TBD

OPTIONS
    TBD

__USAGE__
