## -*- sh -*-

## to-ext

## Check that we are clean. Otherwise the git-log-dump will not match with mods
## on disk. We don't count any existing git-log-dump as a problem.
if (($(git st --porcelain 2>&1 | grep -v git-log-dump 2>&1 | wc -l)))
then
    echo "Will not create shar. Repo not clean."
    git status
    exit 1
fi

## Write the commit log to text. That will keep track of the modifications,
## perhaps to create a decent commit message on the other side.
git log > git-log-dump

## Create the shar
sharout=personal-bb-$(date +%Y-%m-%d).shar
shar -q -o $sharout $(git ls-files) git-log-dump
echo sharfile is $sharout
