#!/usr/bin/env bash

echo "$(date): git-check-with-master" >> "$HOME/.gitaudit"

# git-check-with-master

## clone-and-fork repos need to check with the master in the canonical
## upstream branch.  If there is no 'upstream', then it's probably a clone
## only, so check against the master in origin.
declare status
declare upstream
upstream=$(git remote get-url upstream 2>/dev/null)
if [ -n "${upstream}" ]
then
    git-check-with-remote --remote upstream --branch master "$@"
    status=$?
else
    declare origin
    origin=$(git remote get-url origin 2>/dev/null)
    if [ -n "${origin}" ]
    then
        git-check-with-remote --remote origin --branch master "$@"
        status=$?
    else
        cmd-echo --ec -- "Current repo is not a clone of a remote"
        status=1
    fi
fi
exit $status

## You can add sections with =head1, but stick to =item for section breakdowns,
## not =head2/3/etc/.

:<<'__PODUSAGE__'
=head1 NAME

git-check-with-master - Check current repo/branch against source repo/master

=head1 SYNOPSIS

 git-check-with-master

=head1 DESCRIPTION

Check against the source remote repo, branch master to see if the two in line.

=back

__PODUSAGE__
