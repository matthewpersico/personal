# -*- sh -*-
# shellcheck shell=bash

# Read the list
declare list=$1
if [[ -z $list ]]; then
    list="${TILDAE:-$HOME}/perl/local/src/tarballs"
    cmd-echo --wc --id perl-local-install-modules "No list argument specified. Using default of '$list'."
else
    shift;
fi
if [[ ! -r $list ]]; then
    cmd-echo --ec --id perl-local-install-modules "Tarball list $list not readable."
    false; exit
fi

declare prefix=$1
if [[ -z $prefix ]]; then
    prefix="${TILDAE:-$HOME}/perl/local"
    cmd-echo --wc --id perl-local-install-modules "No prefix argument specified. Using default of '$prefix'."
    if [[ ! -d $prefix ]]; then
        mkdir -p "$prefix"
    fi
else
    shift;
fi
if [[ ! -d $prefix ]]; then
    cmd-echo --ec -=id perl-local-install-modules "Directory $prefix not found."
    false; exit
fi

declare tarball
while read -r tarball; do
    perl-local-install-module \
        --prefix "$prefix" \
        "$prefix/src/$tarball"
done < <(cat "$list")
