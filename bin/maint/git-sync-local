#!/usr/bin/env bash

# git-sync-local

# Specialty script to sync a source branch to target branch on the "origin' git
# repo system.

if [[ -z $1 ]]; then
    # shellcheck disable=SC2155 #https://github.com/koalaman/shellcheck/wiki/SC2155
    declare me=$(basename "$0")
    echo "usage:$me source-branch target-branch"
    echo "      Typically: $me abranch main"
    exit 0
fi

declare source=$1;shift
declare target=$1;shift

(
    cd "$(git root)" || exit 1

    # Refresh the repo
    git fetch --all --prune --tags || exit 1

    # Refresh the 'source' branch:
    git switch "${source}" || exit 1
    git pull || exit 1

    # Copy the new commits from 'source' onto 'target':
    git switch "${target}" || exit 1
    git pull || exit 1
    git rebase "${source}" || exit 1

    # Send 'em up
    git push || exit 1

)
exit $?
