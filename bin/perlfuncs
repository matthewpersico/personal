# -*- sh -*-

# perlfuncs

PERLFUNCS_FILE=${BASH_SOURCE[0]}

auditfuncs_init $PERLFUNCS_FILE

perlfuncs-edit ()
{
    perlfuncs_audit "$@"
    local editor; editor=$(editor_opt xo "$@"); shift $?
    $editor $PERLFUNCS_FILE
}
#nxport -f perlfuncs-edit
## I define functions with '_' and aliases with '-' because the emaacs modes
## that parse for functions to generate jump lists don't see functions with '-'
## in their name. Ugh.

perlfuncs-reload ()
{
    perlfuncs_audit "$@"
    . $PERLFUNCS_FILE
}
#nxport -f perlfuncs-reload

addpath -x -f -p PERL5LIB ~/personal/share/perl5/site_perl/5.16

alias pd='perldoc '

perl-current-version()
{
    ## Prints Maj.Min. If $1 == --full, prints Maj.Min.Patch
    perl -MConfig -MData::Dumper -e '$x=$Config{version};$x=~s/(\.[0-9]+$)//;print $x'-- $1
}

perl-add-local()
{
    ## Clean first in case they exist in the wrong order
    perl-del-local

    local pcv=$(perl-current-version)
    ## Remember, these are in reverse order of how they need to appear
    addpath -x -f -p PERL5LIB ~/perl/share/perl5
    addpath -x -f -p PERL5LIB ~/perl/share/perl5/site_perl
    addpath -x -f -p PERL5LIB ~/perl/share/perl5/site_perl/$pcv
    addpath -x -f -p PERL5LIB ~/perl/lib/perl5
    addpath -x -f -p PERL5LIB ~/perl/lib/perl5/site_perl
    addpath -x -f -p PERL5LIB ~/perl/lib/perl5/site_perl/$pcv
    addpath -x -f -p PATH ~/perl/bin
    addpath -x -f -p MANPATH ~/perl/man

    perl-list-local
}
#nxport -f perl-add-local
alias perl-local-add='perl-add-local '

perl-list-local()
{
    listpath -p PERL5LIB | grep ~/perl
    listpath -p PATH | grep ~/perl/bin
    listpath -p MANPATH | grep ~/perl/man
}
#nxport -f perl-list-local
alias perl-local-list='perl-list-local '

perl-del-local()
{
    local pcv=$(perl-current-version)
    delpath -x -c -p PERL5LIB ~/perl/share/perl5
    delpath -x -c -p PERL5LIB ~/perl/share/perl5/site_perl
    delpath -x -c -p PERL5LIB ~/perl/share/perl5/site_perl/$pcv
    delpath -x -c -p PERL5LIB ~/perl/lib/perl5
    delpath -x -c -p PERL5LIB ~/perl/lib/perl5/site_perl
    delpath -x -c -p PERL5LIB ~/perl/lib/perl5/site_perl/$pcv
    delpath -x -c -p PATH ~/perl/bin
    delpath -x -c -p MANPATH ~/perl/man
}
#nxport -f perl-del-local
alias perl-local-del='perl-del-local '

perl-filter-code ()
{
    local file
    for file in $*
    do
        head -1 $file | grep perl | grep -E '^#!' > /dev/null
        if [ "$?" == '0' ]
        then
            foundperl="$foundperl $i"
        else
            echo $file | grep -iE '\.(p[ml]|t|sgi)$' > /dev/null
            if [ "$?" == '0' ]
            then
                foundperl="$foundperl $i"
            fi
        fi
    done
    echo $foundperl
    local words=($foundperl)
    return ${#words[@]}
}
#nxport -f perl-filter-code

perl-find-code ()
{
    perl-filter-code $(find "$@")
    return $?
}
#nxport -f perl-find-code
